(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const J=e=>{e.remove()},R=(e,t)=>e.some(o=>o._id===t),V=(e,t,o)=>{e.classList.toggle("card__like-button_is-active"),t.textContent=o.length},K=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{currentUserId:t,onPreviewPicture:o,onLikeIcon:s,onDeleteClick:r})=>{const n=K(),i=n.querySelector(".card__like-button"),h=n.querySelector(".card__like-count"),c=n.querySelector(".card__control-button_type_delete"),m=n.querySelector(".card__image");return m.src=e.link,m.alt=e.name,n.querySelector(".card__title").textContent=e.name,h.textContent=e.likes.length,R(e.likes,t)&&i.classList.add("card__like-button_is-active"),e.owner._id!==t?c.remove():c.addEventListener("click",()=>r(n,e._id)),i.addEventListener("click",()=>s(i,e._id,h)),m.addEventListener("click",()=>o({name:e.name,link:e.link})),n},M=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},d=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",M)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",M)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})};function P(e,t,o,s){const r=e.querySelector(`#${t.id}-error`);t.classList.add(s.inputErrorClass),r.textContent=o,r.classList.add(s.errorClass)}function G(e,t,o){const s=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),s.textContent="",s.classList.remove(o.errorClass)}function Q(e,t,o){if(t.dataset.errorMessage&&!/^[A-Za-zА-Яа-яЁё\s-]+$/.test(t.value)){P(e,t,t.dataset.errorMessage,o);return}if(!t.validity.valid){P(e,t,t.validationMessage,o);return}G(e,t,o)}function X(e){return e.some(t=>!t.validity.valid)}function Y(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function ee(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function T(e,t,o){X(e)?Y(t,o):ee(t,o)}function te(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);T(o,s,t),o.forEach(r=>{r.addEventListener("input",()=>{Q(e,r,t),T(o,s,t)})})}function oe(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{te(o,e)})}const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"a4f3a341-4a49-4340-b53f-28b8a222dea7","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),re=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(p),F=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(p),ne=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(p),se=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(p),ce=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(p),ae=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(p),ie=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(p),A=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),b=L.querySelector(".popup__form"),D=b.querySelector(".popup__input_type_name"),N=b.querySelector(".popup__input_type_description"),le=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),E=k.querySelector(".popup__form"),ue=E.querySelector(".popup__input"),x=document.querySelector(".popup_type_new-card"),f=x.querySelector(".popup__form"),pe=f.querySelector(".popup__input_type_card-name"),de=f.querySelector(".popup__input_type_url"),me=document.querySelector(".profile__add-button"),I=document.querySelector(".popup_type_image"),U=I.querySelector(".popup__image"),_e=I.querySelector(".popup__caption"),B=document.querySelector(".popup_type_remove-card"),fe=B.querySelector(".popup__form"),y=document.querySelector(".popup_type_info"),ye=y.querySelector(".popup__title"),_=y.querySelector(".popup__info"),he=y.querySelector(".popup__text"),w=y.querySelector(".popup__list"),Se=document.getElementById("popup-info-definition-template"),ve=document.getElementById("popup-info-user-preview-template"),Le=document.querySelector(".header__logo");let v=null,O=null,W=null;const l=(e,t,o,s)=>{e.textContent=t?s:o},H=({name:e,link:t})=>{U.src=t,U.alt=e,_e.textContent=e,d(I)},be=e=>{e.preventDefault();const t=e.submitter;l(t,!0,"Сохранить","Сохранение..."),ne({name:D.value,about:N.value}).then(o=>{C.textContent=o.name,g.textContent=o.about,u(L)}).catch(console.log).finally(()=>{l(t,!1,"Сохранить","Сохранение...")})},Ce=e=>{e.preventDefault();const t=e.submitter;l(t,!0,"Сохранить","Сохранение..."),se(ue.value).then(o=>{q.style.backgroundImage=`url(${o.avatar})`,u(k)}).catch(console.log).finally(()=>{l(t,!1,"Сохранить","Сохранение...")})},ge=e=>{e.preventDefault();const t=e.submitter;l(t,!0,"Создать","Создание...");const o=pe.value,s=de.value;ce({name:o,link:s}).then(r=>{const n=$(r,{currentUserId:v,onPreviewPicture:H,onLikeIcon:z,onDeleteClick:j});A.prepend(n),u(x),f.reset()}).catch(console.log).finally(()=>{l(t,!1,"Создать","Создание...")})},j=(e,t)=>{O=e,W=t,d(B)};fe.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;l(t,!0,"Да","Удаление..."),ae(W).then(()=>{J(O),u(B)}).catch(console.log).finally(()=>{l(t,!1,"Да","Удаление...")})});const z=(e,t,o)=>{const s=e.classList.contains("card__like-button_is-active");ie(t,s).then(r=>{V(e,o,r.likes)}).catch(console.log)},S=(e,t)=>{const o=Se.content.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},qe=e=>{const t=ve.content.cloneNode(!0);return t.querySelector(".popup__list-item").textContent=e,t},ke=()=>{_.innerHTML="",w.innerHTML="",ye.textContent="Статистика карточек",F().then(e=>{const o=new Set(e.map(c=>c.owner.name)).size,s=e.reduce((c,m)=>c+m.likes.length,0),r=Math.max(...e.map(c=>c.likes.length)),n=e.find(c=>c.likes.length===r),i=n?n.owner.name:"—",h=e.filter(c=>c.likes.length===r).map(c=>c.name);_.append(S("Всего пользователей:",o)),_.append(S("Всего лайков:",s)),_.append(S("Максимально лайков от одного:",r)),_.append(S("Чемпион лайков:",i)),he.textContent="Популярные карточки:",h.forEach(c=>{w.append(qe(c))}),d(y)}).catch(console.log)};Le.addEventListener("click",ke);b.addEventListener("submit",be);f.addEventListener("submit",ge);E.addEventListener("submit",Ce);le.addEventListener("click",()=>{D.value=C.textContent,N.value=g.textContent,d(L)});q.addEventListener("click",()=>{E.reset(),d(k)});me.addEventListener("click",()=>{f.reset(),d(x)});document.querySelectorAll(".popup").forEach(e=>{Z(e)});oe({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});Promise.all([re(),F()]).then(([e,t])=>{v=e._id,C.textContent=e.name,g.textContent=e.about,q.style.backgroundImage=`url(${e.avatar})`,t.reverse().forEach(o=>A.append($(o,{currentUserId:v,onPreviewPicture:H,onLikeIcon:z,onDeleteClick:j})))}).catch(console.log);
